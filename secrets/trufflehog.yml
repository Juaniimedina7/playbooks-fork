settings:
  name: "Hardcoded Secrets with Trufflehog"
  description: "Files were found containing hardcoded secrets"
  mitigation: "Remove the secrets from the code whenever possible"
  image: python
  author:
    - https://github.com/trufflesecurity
  example: satori run ./ --playbook satori://secrets/trufflehog.yml --report --output

trufflehog:
  install:
    - pip uninstall semgrep jsonschema mobsfscan referencing -qy
    - pip install trufflehog3 -q --disable-pip-version-check

  help:
    - trufflehog3 --help

  high:
    assertStdoutNotContains: HIGH
    setSeverity: 1
    run:
      - trufflehog3 filesystem . --no-entropy -s HIGH | sed -e "s/~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~//" | cut -b -200

  medium:
    assertStdoutNotContains: MEDIUM
    setSeverity: 3
    run:
      - trufflehog3 filesystem . --no-entropy -s MEDIUM | sed -e "s/~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~//" | cut -b -200

  low:
    assertStdoutNotContains: LOW
    setSeverity: 5
    run:
      - trufflehog3 filesystem . --no-entropy -s LOW | sed -e "s/~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~//" | cut -b -200
