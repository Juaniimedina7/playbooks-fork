settings:
  name: "detect-secrets: find secrets within your code base"
  description: "detect-secrets identifies and prevents accidental exposure of secrets in code repositories by scanning for sensitive information such as API keys, passwords, and credentials using pattern matching and heuristics."
  image: python
  author:
    - https://github.com/Yelp
  example: satori run ./ --playbook satori://secrets/detect-secrets.yml --report --output

detect-secrets:
  install:
    - apt update >>/dev/null; apt install -qy jq >>/dev/null
    - pip3 install detect-secrets -q --disable-pip-version-check

  help:
    - detect-secrets --help

  test:
    run:
      - "detect-secrets scan ./ --all-files | jq -r '.results | to_entries[] | .value[] | \"\\(.filename):\\(.line_number)\"' > output"
    output:
      assertStdoutEqual: "{}\n"
      run:
        - "while read line; do file=$(echo \"$line\" | cut -d':' -f 1); line_num=$(echo \"$line\" | cut -d':' -f 2); echo File:$file, Line: $line_num:; sed -n \"${line_num}p\" $file; done < output"
