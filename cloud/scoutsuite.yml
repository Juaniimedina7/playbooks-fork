settings:
  image: ubuntu:jammy
  name: "Scoutsuits - Multi-cloud security-auditing tool that highlights risk areas"
  files: True
  example: satori run satori://cloud/scoutsuite.yml -d aws_secret_access_key="TBC" -d aws_access_key_id="TBC" --files --output
  
install:
  update:
  - apt update
  dependencies:
  - apt install -qy python3 python3-pip jq
  scoutsuite:
  - pip3 install scoutsuite -q --disable-pip-version-check --root-user-action=ignore

scout:
  run:
    - scout aws --access-key-id ${{aws_access_key_id}} --secret-access-key ${{aws_secret_access_key}}
  output:
    - "set +f; cat scoutsuite-report/scoutsuite-results/scoutsuite_results_aws-*.js"
  results:
    assertStdout: False
    danger:
      - "tail -n +2 scoutsuite-report/scoutsuite-results/scoutsuite_results_aws-*.js | jq '.services[].findings[] | select(.level == \"danger\")'"
    # warning:
    # - "tail -n +2 scoutsuite-report/scoutsuite-results/scoutsuite_results_aws-*.js | jq '.services[].findings[] | select(.level == \"warning\")'"
